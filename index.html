<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8">
    <title>Progetto di Tesi Panotour con navigazione in A-Frame</title>
    <meta name="description" content="Progetto di Tesi Panotour con navigazione in A-Frame">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- A-Frame core -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

    <!-- Componenti personalizzati (se li usi) -->
    <script src="js/components/aframe-tooltip-component.js"></script>
    <script src="js/components/camera-position.js"></script>
    <script src="js/components/link-controls.js"></script>

    <style>
      #audioToggle {
        position: absolute; top: 10px; right: 10px;
        background: #fff; border-radius: 50%; padding: 10px;
        cursor: pointer; user-select: none;
        box-shadow: 0 2px 8px rgba(0,0,0,.2);
        font-size: 18px; line-height: 1;
      }
    </style>
  </head>
  <body>
    <a-scene
      cursor="rayOrigin: mouse"
      raycaster="far: 100; objects: .clickable, [link];"
      camera-position>

      <!-- Asset -->
      <a-assets>
        <!-- Panorama e preview -->
        <img id="sky" crossorigin="anonymous" src="foto/atrioingresso3.jpeg">
        <img id="aristodemopreview" crossorigin="anonymous" src="foto/atriopreviewalto.jpg">
        <img id="pianopreview" crossorigin="anonymous" src="foto/pianopreview.jpg">
        <img id="esternopreview" crossorigin="anonymous" src="foto/esternovilla.jpeg">
        <img id="cappellapreview" crossorigin="anonymous" src="foto/cappellapreview.jpg">
        <img id="direzionepreview" crossorigin="anonymous" src="foto/direzionepreview.jpg">

        <!-- Logo -->
        <img id="logo" crossorigin="anonymous" src="logo/villa_ventilj_logo.png">

        <!-- Modella + suoni -->
        <a-asset-item id="welcomeModel" src="model/sophiawelcome.glb"></a-asset-item>
        <audio id="welcomeSnd" src="audio/welcome.mp3"></audio>
        <audio id="bgSnd" src="audio/ingresso.mp3"></audio>

        <!-- Icona play -->
        <img id="playIconImg" src="icons/play1.png">
      </a-assets>

      <!-- Cielo 360Â° -->
      <a-sky src="#sky" rotation="0 -80 0"></a-sky>

      <!-- Modella -->
      <a-entity id="welcomeChar"
                gltf-model="#welcomeModel"
                position="-14 -12 -4"
                rotation="0 80 0"
                scale="0.1 0.1 0.1">
      </a-entity>

      <!-- Icona Play davanti alla modella -->
      <a-image id="playIcon"
               class="clickable"
               src="#playIconImg"
               position="-7 0 -1"
               scale="1 1 1"
               transparent="true">
      </a-image>

      <!-- Suono di benvenuto -->
      <a-entity id="welcomeVoice"
                sound="src: #welcomeSnd; volume: 2"></a-entity>

      <!-- Link stanza 1: Cappella -->
      <a-link href="cappella.html"
              title="Villa Ventilj - Cappella privata"
              image="#cappellapreview"
              position="-3 0.5 -2"
              rotation="0 30 0"></a-link>

      <!-- Link stanza 2: Atrio principale -->
      <a-link href="atrio.html"
              title="Villa Ventilj-Atrio principale"
              image="#aristodemopreview"
              position="6 0.5 2"
              rotation="0 100 0"></a-link>

      <!-- Link stanza 3: Piano nobile -->
      <a-link href="pianonobile.html"
              title="Villa Ventilj - Museo Raffaello Pagliaccetti"
              image="#pianopreview"
              position="2 0.5 -3"
              rotation="0 -25 0"></a-link>

      <!-- Link stanza 4: Direzione -->
      <a-link href="direzione.html"
              title="Villa Ventilj - Stanze di Pasquale Ventilj"
              image="#direzionepreview"
              position="3 0.5 6"
              rotation="0 30 0"></a-link>

      <!-- Link stanza 5: Esterno Giardino -->
      <a-link href="esternogiardino.html"
              title="Villa Ventilj - Esterno"
              image="#esternopreview"
              position="-5 0.5 3.5"
              rotation="0 -80 0"
              scale="1 1 1"></a-link>

      <!-- Tappo treppiede + logo -->
      <a-entity position="10 -130 12">
        <a-cylinder radius="50" height="0.5" color="#ffffff"></a-cylinder>
        <a-image src="#logo" position="0 1 0" width="70" height="70" rotation="90 115 0" scale="-1 1 1"></a-image>
      </a-entity>

      <!-- Luci -->
      <a-entity light="type: ambient; intensity: 0.7"></a-entity>
      <a-entity light="type: directional; intensity: 0.8" position="1 3 2"></a-entity>

      <!-- Controller VR -->
      <a-entity id="leftHand" link-controls="hand: left"></a-entity>
      <a-entity id="rightHand" link-controls="hand: right"></a-entity>

      <!-- Audio di sottofondo -->
      <a-entity id="bgAudio" sound="src: #bgSnd; autoplay: true; loop: true; volume: 1"></a-entity>
    </a-scene>

    <!-- Toggle audio -->
    <div id="audioToggle">ðŸ”Š</div>

    <script>
      // Play welcome al click sull'icona
      const playIcon = document.getElementById('playIcon');
      const welcomeVoice = document.getElementById('welcomeVoice');
      playIcon.addEventListener('click', () => {
        const snd = welcomeVoice.components.sound;
        try { snd.stopSound(); } catch(e) {}
        snd.playSound();
      });

      // Toggle audio di sottofondo
      const audioToggle = document.getElementById('audioToggle');
      const bgAudioEnt  = document.getElementById('bgAudio');
      const bgSound     = () => bgAudioEnt?.components?.sound;
      let bgOn = true;

      audioToggle.addEventListener('click', () => {
        bgOn = !bgOn;
        if (!bgSound()) return;
        if (bgOn) { bgSound().playSound(); audioToggle.textContent = 'ðŸ”Š'; }
        else      { bgSound().pauseSound(); audioToggle.textContent = 'ðŸ”‡'; }
      });
    </script>
  </body>
</html>

